pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
actors={}

function add_act(x,y,s,cw)
	a = {x=x, y=y, s=s, cw=cw, t=1}
	add(actors, a)
	return a
end

function _init()
	mode = 0 -- title
	title = {
		{x=30,y=0,s=18},
		{x=37,y=0,s=19},
		{x=46,y=0,s=20},
		{x=54,y=0,s=21},
		{x=62,y=0,s=22},
		{x=70,y=0,s=23},
		{x=74,y=0,s=20},
		{x=82,y=0,s=24},
		
		{x=30,y=8,s=34},
		{x=37,y=8,s=35},
		{x=46,y=8,s=36},
		{x=54,y=8,s=37},
		{x=62,y=8,s=38},
		{x=70,y=8,s=39},
		{x=74,y=8,s=36},
		{x=82,y=8,s=40}
	}
	
	stars = {}
	debris = {}
	hero = {}
	upd_stars_particles()
	music(0)
--	game_init() --debug
end

function game_init()
 music(-1)
	upd_stars_particles()
	init_actors()
	mode = 1
	music(1)
end

function init_actors(s)
	hero = add_act(56, 112, 0, true)
	hero.sx = 80
	hero.sy = 0
	add(debris,add_act(10, 0, 16, false))
end

function _update()
	if (mode == 1) then
		game_update()
	else
		title_update()
	end
end

function title_update()
	if btn(4) then
		game_init()
	end
end

function game_update()
	player_update()
	upd_stars_particles()
	update_debris()
end

function _draw()
	cls()
	if (mode == 1) then
		game_draw()
	else
		title_draw()
	end
end

function title_draw()
	draw_stars()
	for t in all(title) do
		spr(t.s, t.x + 5, t.y + 40)
end

	print("press start to begin",27, 70, 7)
end

function player_update()
		local lx=hero.x --last x
		local ly=hero.y --last y
		if (btn(0)) hero.x-=2 --left
		if (btn(1))	hero.x+=2 --right
		if (cmap(hero)) hero.x=lx
		if (btn(2)) hero.y-=2 --up
		if (btn(3)) hero.y+=2 --down
		if (cmap(hero)) hero.y=ly
		
end

function game_draw()
	draw_stars()
	for d in all(debris) do
		spr(d.s, d.x, d.y)
	end
	draw_hero()
end

function draw_stars()
	for s in all(stars) do
		--line(s.x,s.y,s.x,s.y,s.col)
		pset(s.x,s.y,s.col)
	end
end

function draw_hero()

	if (btn(0)) then	
	sspr(88,hero.sy,8,16,hero.x,hero.y)
	else if (btn(1)) then sspr(88,hero.sy,8,16,hero.x,hero.y, 8, 16, true)
	else
 spr(10, hero.x, hero.y, 1,2)
 spr(10, hero.x+8, hero.y, 1,2, true)
	end
	end
end

function cmap(o)
	local cb=false
	if(o.cw) then
		cb=(o.x<0 or o.x+8>127 or o.y<0 or o.y+8>127)
	end
	return cb
end

function init_star_particles()
	for i=1,flr(rnd(5))+50 do
		--star(flr(rnd(128)),flr(rnd(128)),rnd(3)+1)
		star(flr(rnd(128)),flr(rnd(128)),1)
	end
end

function upd_stars_particles()
	for i=1,flr(rnd(2))+1 do
		--star(flr(rnd(128)),0,rnd(3)+1)
		star(flr(rnd(128)),flr(rnd(128)),1)
	end
	
	for s in all(stars) do
		s.y += s.dy*5
		if s.y > 128 then
			del(stars,s)
		end
	end
end

function star(x, y, dy)
	local s={x=x, y=y, dy=dy, col=4+dy}
	if flr(s.col)==5 then s.col=1 end
	add(stars, s)
end

function update_debris()
	for d in all(debris) do
		d.y += 1
		d.x += .5
		if d.y > 128 then	del(debris,d) end
	end
end
__gfx__
00000000000880000080000000000800000700220000000822007000800000000000000000000000000000080080000000000008800000000000000000000000
00000000000760000860000000000680000702720000000727207000700000000000000000000000000000070870000000000007700000000000000000000000
00700700070760600760600000060670000787770000000777787000700000000000000000000000000000070770000000000007700000000000000000000000
00077000080760800760800000080670000777220000000722777000700000000000000000000000000000070770000000000007700000000000000000000000
00177000076556600566600000066650000772820000000728277000700000000000000000000000000000070770000000000007700000000000000000000000
00700700077776600766600000066670007728820000000728827700700000000000000000000000000000070270000000000007700000000000000000000000
00000000778768660786600000066870007220280007007782022700770070000000000000000000000700777270700000070077770070000000000000000000
00000000780000860008860000688000008220000007002700022800720070000000000000000000000700277220700000070027720070000000000000000000
01117000088008800777700007700077000770000777700007777700077000000770007000999000000700222270700000000000000000000000000000000000
01d71700888887787777770007700077000770000777777007777770077000000770007000090000000702722272700000000000000000000000000000000000
1dd17770888888787770777007700077007777000770077707700777077000000770007000090000000787777778700000000000000000000000000000000000
1d111770888888887700077007700077007007000770007707700077077000000777007000000000000777227727700000000000000000000000000000000000
1d111d70088888807700000007700077007007000770007707700077077000000777007000000000000772822222700000000000000000000000000000000000
11ddd170008888007700000007700077007007000770007707700077077000000777707000090000007728822828270000000000000000000000000000000000
01d11700000880009909999009900099099009900990099009900099099000000999909000090000007220288288822000000000000000000000000000000000
001dd000000000009909999009900099099009900999990009900099099000000999909000090000008220000000828000000000000000000000000000000000
00000000000700229900099009900099099009900999990009900099099000000990999000000000000000000000000000000000000000000000000000000000
00000000000702729900099009900099090000900990099009900099099000000990999000000000000000000000000000000000000000000000000000000000
00000000000787778800088008800088080000800880008808800088088000000880888000000000000000000000000000000000000000000000000000000000
00000000000777229900099009900099090000900990009909900099099000000990099000000000000000000000000000000000000000000000000000000000
00000000000772828800088008800088888888880880008808800088088000000880088000000000000000000000000000000000000000000000000000000000
00000000007728828800888008880888888888880880008808800888088000000880088000000000000000000000000000000000000000000000000000000000
00000000007220288888808008888888880000880880008808888880088000000880008000000000000000000000000000000000000000000000000000000000
00000000008220000088008000888880880000880880008808888800088000000880008000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000880008800000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000880008800000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
011900001a0601a0601a0611a0511a0411a0311b0551d05020050200501f0501f0501d0501d0501b0501b0501d0741d0351a0601a0601a0601a0511a0411a03122074220351d0601d0601d0601d0511d0411d031
011900000a120051200a120051200a120051200a120051200f1200a1200f1200a1200f1200a1200f1200a1200a120051200a120051200a120051200a120051200a120051200a120051200a120051200a12005120
011900001a0601a0601a0611a0611a0611a0611b0551d05020050200501f0501f0501d0501d0501b0501b0501d0741d0351a0501a0501a0501a0501a0501a05022074220351d0601d0601d0601d0601d0601d060
011e000015050150500e0500e0501a050150501305012050100501005004130071300c1300413013050130500e0500e050170501305015050170501805018050180501505017050180501a0601a0601a0601a065
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000000030200302003020030200302003021e3421b342003020030200302003020030200302003020030200302003020030200302003020030200302003020030200302003020030200302003020030200302
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000001c0501c0451c0451c04500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
04 03464344
03 00014344

